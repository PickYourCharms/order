<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Build My Bracelet</title>

<style>
  :root {
    --text: #111;
    --muted: #777;
    --border: #e6e6e6;
    --accent: #000;
    --surface: #fafafa;
  }

  body {
    margin: 0;
    padding: 16px 14px 120px;
    font-family: system-ui, -apple-system, sans-serif;
    background: #fff;
    color: var(--text);
    text-align: center;
  }

  /* ================= HEADER ================= */
  .topbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    max-width: 420px;
    margin: 0 auto 10px;
  }

  .topbar button {
    background: none;
    border: none;
    font-size: 14px;
    cursor: pointer;
  }

  h2 {
    margin: 6px 0 12px;
    font-size: 18px;
  }

  /* ================= METAL TOGGLE ================= */
  .metal-toggle {
    display: inline-flex;
    gap: 8px;
    margin-bottom: 12px;
  }

  .metal-toggle button {
    padding: 6px 14px;
    border-radius: 999px;
    border: 1px solid var(--border);
    background: #fff;
    cursor: pointer;
    font-size: 13px;
  }

  .metal-toggle .active {
    background: var(--accent);
    color: #fff;
    border-color: var(--accent);
  }

  /* ================= CANVAS ================= */
  .canvas-wrap {
    background: var(--surface);
    border-radius: 20px;
    padding: 18px 0 10px;
    margin-bottom: 8px;
  }

  .canvas {
    position: relative;
    width: min(92vw, 360px);
    aspect-ratio: 1 / 1;
    margin: 0 auto;
  }

  .bracelet {
    position: absolute;
    width: 72%;
    height: 72%;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    pointer-events: none;
  }

  .charm {
    position: absolute;
    cursor: pointer;
    user-select: none;
    transform-origin: top center;
    animation: pop 140ms ease-out;
  }

  .charm img {
    display: block;
    pointer-events: none;
  }

  @keyframes pop {
    from { opacity: 0; transform: scale(.96); }
    to   { opacity: 1; transform: scale(1); }
  }

  .hint {
    font-size: 13px;
    color: var(--muted);
    margin-top: 8px;
  }

  /* ================= TRAY ================= */
  .tray {
    display: flex;
    justify-content: center;
    gap: 14px;
    margin-top: 16px;
  }

  .tray img {
    width: 44px;
    cursor: pointer;
  }

  /* ================= PRICE ================= */
  .price {
    margin: 14px 0 18px;
    font-weight: 600;
  }

  /* ================= CTA ================= */
  .cta {
    position: fixed;
    left: 0;
    right: 0;
    bottom: 16px;
    display: flex;
    justify-content: center;
  }

  .cta button {
    width: min(92vw, 360px);
    padding: 16px;
    border-radius: 999px;
    border: none;
    background: #000;
    color: #fff;
    font-size: 15px;
    cursor: pointer;
  }

  .cta button:disabled {
    opacity: .35;
    cursor: not-allowed;
  }

  /* ================= MODAL ================= */
  .modal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.4);
    display: none;
    align-items: center;
    justify-content: center;
  }

  .modal-content {
    background: #fff;
    border-radius: 16px;
    padding: 18px;
    width: 86%;
    max-width: 320px;
    text-align: center;
  }

  .modal-actions {
    display: flex;
    gap: 10px;
    margin-top: 14px;
  }

  .modal-actions button {
    flex: 1;
    padding: 10px;
    border-radius: 999px;
    border: 1px solid var(--border);
    cursor: pointer;
    background: #fff;
  }

  .modal-actions .danger {
    background: #000;
    color: #fff;
    border-color: #000;
  }
</style>
</head>

<body>

<div class="topbar">
  <button onclick="history.back()">← Back</button>
  <strong>Build My Bracelet</strong>
  <button onclick="confirmReset()">Reset</button>
</div>

<div class="metal-toggle">
  <button id="goldBtn" class="active" onclick="switchMetal('gold')">Gold</button>
  <button id="silverBtn" onclick="switchMetal('silver')">Silver</button>
</div>

<div class="canvas-wrap">
  <div class="canvas" id="canvas">
    <img id="braceletBase" class="bracelet"
      src="assets/bases/bracelet_base_gold.png" />
  </div>
</div>

<div class="hint">Tap to personalise your bracelet</div>

<div class="tray" id="tray"></div>

<div class="price" id="priceText">Bracelet total · Rs. 249</div>

<div class="cta">
  <button id="ctaBtn" disabled>Love it — Add this bracelet ✨</button>
</div>

<!-- RESET / METAL MODAL -->
<div class="modal" id="confirmModal">
  <div class="modal-content">
    <strong>Start fresh?</strong>
    <p style="font-size:13px;color:#666">
      Your current design will be cleared.
    </p>
    <div class="modal-actions">
      <button onclick="closeModal()">Cancel</button>
      <button class="danger" onclick="hardReset()">Reset</button>
    </div>
  </div>
</div>

<script>
/* ================= LOCKED PHYSICS ================= */
const CHARM_PHYSICS = {
  size: 46,
  anchorX: 23,
  anchorY: 6,
  scale: 0.9,
  attachOffset: 2
};

const SLOT_ANGLES = {
  1: [90],
  2: [70,110],
  3: [60,90,120],
  4: [45,75,105,135],
  5: [40,65,90,115,140]
};

/* ================= STATE ================= */
const canvas = document.getElementById('canvas');
const tray = document.getElementById('tray');
const braceletBase = document.getElementById('braceletBase');
const priceText = document.getElementById('priceText');
const ctaBtn = document.getElementById('ctaBtn');
const modal = document.getElementById('confirmModal');

let charms = [];
let metal = 'gold';
let pendingMetal = null;

/* ================= DATA ================= */
const CHARMS = [
  '3DBowRibbon_Charm',
  'EvilEye_Charm',
  'LetterA_Charm',
  'NorthStar_Charm',
  'RedCherry_Charm'
];

/* ================= INIT ================= */
renderTray();

/* ================= ACTIONS ================= */
function addCharm(src) {
  if (charms.length >= 5) return;
  charms.push(src);
  render();
}

function removeCharm(i) {
  charms.splice(i,1);
  render();
}

function render() {
  document.querySelectorAll('.charm').forEach(c => c.remove());
  if (!charms.length) {
    updatePrice();
    return;
  }

  const rect = canvas.getBoundingClientRect();
  const cx = rect.width / 2;
  const cy = rect.height / 2;
  const radius = rect.width * 0.36;
  const angles = SLOT_ANGLES[charms.length];

  charms.forEach((src, i) => {
    const angle = angles[angles.length - 1 - i];
    const rad = angle * Math.PI / 180;

    const x = cx + radius * Math.cos(rad);
    const y = cy + radius * Math.sin(rad) + CHARM_PHYSICS.attachOffset;

    const wrap = document.createElement('div');
    wrap.className = 'charm';
    wrap.style.left = (x - CHARM_PHYSICS.anchorX) + 'px';
    wrap.style.top  = (y - CHARM_PHYSICS.anchorY) + 'px';
    wrap.style.transform =
      `rotate(${angle - 90}deg) scale(${CHARM_PHYSICS.scale})`;

    const img = document.createElement('img');
    img.src = src;
    img.style.width = CHARM_PHYSICS.size + 'px';

    wrap.appendChild(img);
    wrap.onclick = () => removeCharm(i);
    canvas.appendChild(wrap);
  });

  updatePrice();
}

function updatePrice() {
  const total = 249 + Math.max(0, charms.length - 1) * 80;
  priceText.textContent = `Bracelet total · Rs. ${total}`;
  ctaBtn.disabled = charms.length === 0;
}

/* ================= METAL SWITCH ================= */
function switchMetal(to) {
  if (to === metal) return;

  if (charms.length) {
    pendingMetal = to;
    modal.style.display = 'flex';
    return;
  }
  applyMetal(to);
}

function applyMetal(to) {
  metal = to;
  document.getElementById('goldBtn').classList.toggle('active', to==='gold');
  document.getElementById('silverBtn').classList.toggle('active', to==='silver');

  braceletBase.src =
    `assets/bases/bracelet_base_${to}.png`;

  charms = [];
  renderTray();
  render();
}

function confirmReset() {
  if (!charms.length) return;
  pendingMetal = null;
  modal.style.display = 'flex';
}

function hardReset() {
  modal.style.display = 'none';
  charms = [];
  if (pendingMetal) applyMetal(pendingMetal);
  pendingMetal = null;
  render();
}

function closeModal() {
  modal.style.display = 'none';
  pendingMetal = null;
}

/* ================= TRAY ================= */
function renderTray() {
  tray.innerHTML = '';
  CHARMS.forEach(name => {
    const img = document.createElement('img');
    img.src = `assets/charms/${name}_${metal}.png`;
    img.onclick = () => addCharm(img.src);
    tray.appendChild(img);
  });
}
</script>

</body>
</html>
